<!DOCTYPE html>
<html lang="en" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>DockerfileGrammer | William&#39;s Blog</title>
<meta name="keywords" content="">
<meta name="description" content="Dockerfile语法，构建以及实例分析">
<meta name="author" content="deemoprobe">
<link rel="canonical" href="https://deemoprobe.github.io/posts/tech/docker/dockerfilegrammer/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.437c6a2af4fc60ed76299fc9cd9077545ae1b4ff1cc6481716ecd767dee77e57.css" integrity="sha256-Q3xqKvT8YO12KZ/JzZB3VFrhtP8cxkgXFuzXZ97nflc=" rel="preload stylesheet" as="style">
<script defer crossorigin="anonymous" src="/assets/js/highlight.89eeec8f36cd08246c59f8970019c7295c6a548ff3bdfb632a7ae687603dd4f5.js" integrity="sha256-ie7sjzbNCCRsWfiXABnHKVxqVI/zvftjKnrmh2A91PU="
        onload="hljs.initHighlightingOnLoad();"></script>
<link rel="icon" href="https://deemoprobe.github.io/img/favicon/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="https://deemoprobe.github.io/img/favicon/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://deemoprobe.github.io/img/favicon/favicon-32x32.png">
<link rel="apple-touch-icon" href="https://deemoprobe.github.io/apple-touch-icon.png">
<link rel="mask-icon" href="https://deemoprobe.github.io/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --hljs-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript>

<link rel="stylesheet" href="https://cdn.staticfile.org/font-awesome/4.7.0/css/font-awesome.min.css">
<script src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>

<script src="https://cdn.staticfile.org/jquery/3.6.3/jquery.min.js"></script>


<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = ""; 
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>
<meta property="og:title" content="DockerfileGrammer" />
<meta property="og:description" content="Dockerfile语法，构建以及实例分析" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://deemoprobe.github.io/posts/tech/docker/dockerfilegrammer/" />
<meta property="og:image" content="https://deemoprobe.github.io/img/docker.png" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-04-26T14:52:37+08:00" />
<meta property="article:modified_time" content="2023-04-26T14:52:37+08:00" />

<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:image" content="https://deemoprobe.github.io/img/docker.png" />
<meta name="twitter:title" content="DockerfileGrammer"/>
<meta name="twitter:description" content="Dockerfile语法，构建以及实例分析"/>


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [

        {
          "@type": "ListItem",
          "position":  1 ,
          "name": "📚文章",
          "item": "https://deemoprobe.github.io/posts/"
        },

        {
          "@type": "ListItem",
          "position":  2 ,
          "name": "👨🏻‍💻 技术",
          "item": "https://deemoprobe.github.io/posts/tech/"
        },

        {
          "@type": "ListItem",
          "position":  3 ,
          "name": "Docker",
          "item": "https://deemoprobe.github.io/posts/tech/docker/"
        }, 
    {
      "@type": "ListItem",
      "position":  4 ,
      "name": "DockerfileGrammer",
      "item": "https://deemoprobe.github.io/posts/tech/docker/dockerfilegrammer/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "DockerfileGrammer",
  "name": "DockerfileGrammer",
  "description": "Dockerfile语法，构建以及实例分析",
  "keywords": [
    ""
  ],
  "articleBody": "字段解析 简介 # 主要字段 FROM image[基础镜像,该文件创建新镜像所依赖的镜像] MAINTAINER user[作者姓名和邮箱] RUN command[镜像构建时运行的命令] ADD [文件拷贝进镜像并解压] COPY [文件拷贝进镜像] CMD [容器启动时要运行的命令或参数] ENTRYPOINT [容器启动时要运行的命令] EXPOSE port[声明端口] WORKDIR work_directory[进入容器默认进入的目录] ENV set_env[创建环境变量] VOLUME [容器数据卷,用于数据保存和持久化] ONBUILD [当前Dockerfile构建时不会调用，当子镜像依赖本镜像（FROM）构建时触发ONBUILD后的命令] USER [指定构建镜像和运行容器的用户用户组] ARG [构建镜像时设定的变量] LABEL [为镜像添加元数据] FROM 基础镜像 # 如果不指定版本，默认使用latest FROM image FROM image:tag FROM image@digest # 示例 FROM nginx:1.18.0 MAINTAINER 作者 MAINTAINER user MAINTAINER email MAINTAINER user # 示例 MAINTAINER deemo RUN 构建镜像时执行的命令 # Dockerfile里的指令每执行一次会在镜像文件系统中新建一层，为了避免多层文件造成镜像过大，多条命令写在一个RUN后面 # RUN指令创建的中间镜像会被缓存，并会在下次构建中使用。如果不想使用这些缓存镜像，可以在构建时指定--no-cache参数，如：docker build --no-cache RUN command RUN [\"\",\"\",\"\",...] # 示例 RUN yum install -y curl RUN [\"./test.php\",\"dev\",\"offline\"] #等价于 RUN ./test.php dev offline ADD 本地文件拷贝进镜像，tar类型的会自动解压 ADD # 示例 ADD file /dir/ #添加file到/dir/目录 ADD file dir/ #添加file到{WORKDIR}/dir目录 ADD fi* /dir #通配符，添加所有以fi开头的文件到/dir/目录 COPY 本地文件拷贝进镜像，但不会解压 COPY CMD 容器启动时（docker run时）要运行的命令或参数 # 可以设置多个CMD,但最后一个生效,前面的不生效,也可以被docker run启动容器时后面加的命令替换 CMD [\"\",\"\",\"\",...] #执行可执行文件 CMD [\"\",\"\",...] #已设置ENTRYPOINT，则调用ENTRYPOINT后添加CMD参数 CMD command param1 param2 ... #执行shell内部命令 # 示例 CMD [\"/usr/bin/ls\",\"-al\"] CMD echo \"hello\" ENTRYPOINT 容器启动时要运行的命令 # 类似于CMD指令，但其不会被docker run的命令行参数指定的指令所覆盖 # 存在多个ENTRYPOINT时，仅最后一个生效 ENTRYPOINT [\"\",\"\",\"\",...] # 示例 ENTRYPOINT [\"nginx\", \"-c\"] #定参 CMD [\"/etc/nginx/nginx.conf\"] #变参 EXPOSE 声明容器端口 # EXPOSE仅是声明端口。要使其可访问，需要在docker run运行容器时通过-p来指定端口映射，或通过-P参数来映射EXPOSE端口 EXPOSE [...] # 示例 EXPOSE 80 EXPOSE 80 443 WORKDIR 工作目录 WORKDIR path ENV 设置环境变量 ENV ENV = ... # 示例 ENV dir=/webapp ENV name deemoprobe VOLUME 容器数据卷,用于数据保存和持久化 VOLUME [\"/path/to/dir\"] # 示例 VOLUME [\"/data\"] USER 指定构建镜像和运行容器的用户用户组 USER user USER user:group USER uid USER uid:gid USER user:gid USER uid:group # 示例 USER www USER 1080:tomcat ARG 构建镜像时设定的变量 # 与 ENV 作用一致。不过作用域不一样。ARG 设置的环境变量仅对 Dockerfile 内有效，也就是说只有 docker build 的过程中有效，构建好的镜像内不存在此环境变量。 ARG [=] # 示例 ARG user=www ONBUILD 当构建一个被继承的Dockerfile时运行命令 # 子镜像构建时触发命令并执行。就是Dockerfile里用ONBUILD指定的命令，在本次构建镜像（假设镜像名为test）的过程中不会执行。当有新的Dockerfile使用了该镜像（FROM test），这时执行新镜像的Dockerfile构建时候，会执行test镜像中Dockerfile里的ONBUILD指定的命令。 ONBUILD [INSTRUCTION] # 示例 ONBUILD RUN yum install wget ONBUILD ADD . /data LABEL 为镜像添加元数据 LABEL = = = ... # 示例 LABEL version=\"1.0\" des=\"webapp\" 实例1-简单尝试 [root@demo ~]# docker build --help Usage: docker build [OPTIONS] PATH | URL | - Build an image from a Dockerfile Options: --add-host list Add a custom host-to-IP mapping (host:ip) --build-arg list Set build-time variables --cache-from strings Images to consider as cache sources --cgroup-parent string Optional parent cgroup for the container --compress Compress the build context using gzip --cpu-period int Limit the CPU CFS (Completely Fair Scheduler) period --cpu-quota int Limit the CPU CFS (Completely Fair Scheduler) quota -c, --cpu-shares int CPU shares (relative weight) --cpuset-cpus string CPUs in which to allow execution (0-3, 0,1) --cpuset-mems string MEMs in which to allow execution (0-3, 0,1) --disable-content-trust Skip image verification (default true) -f, --file string Name of the Dockerfile (Default is 'PATH/Dockerfile') --force-rm Always remove intermediate containers --iidfile string Write the image ID to the file --isolation string Container isolation technology --label list Set metadata for an image -m, --memory bytes Memory limit --memory-swap bytes Swap limit equal to memory plus swap: '-1' to enable unlimited swap --network string Set the networking mode for the RUN instructions during build (default \"default\") --no-cache Do not use cache when building the image --pull Always attempt to pull a newer version of the image -q, --quiet Suppress the build output and print image ID on success --rm Remove intermediate containers after a successful build (default true) --security-opt strings Security options --shm-size bytes Size of /dev/shm -t, --tag list Name and optionally a tag in the 'name:tag' format --target string Set the target build stage to build. --ulimit ulimit Ulimit options (default []) # 创建Dockerfile [root@demo ~]# cat Dockerfile FROM centos:centos7.9.2009 # 该镜像已经提前拉取 MAINTAINER deemo RUN curl -o /etc/yum.repos.d/CentOS-Base.repo https://mirrors.aliyun.com/repo/Centos-7.repo \u0026\u0026 sed -i -e '/mirrors.cloud.aliyuncs.com/d' -e '/mirrors.aliyuncs.com/d' /etc/yum.repos.d/CentOS-Base.repo \u0026\u0026 yum install vim -y CMD [\"/bin/echo\",\"hello\"] # 对比父镜像和新镜像，有sed和curl没有vim [root@demo ~]# docker run -it --rm centos:centos7.9.2009 whereis sed sed: /usr/bin/sed [root@demo ~]# docker run -it --rm centos:centos7.9.2009 whereis curl curl: /usr/bin/curl [root@demo ~]# docker run -it --rm centos:centos7.9.2009 whereis vim # 构建镜像 [root@demo ~]# docker build -t centos7:v2 . [+] Building 76.1s (6/6) FINISHED =\u003e [internal] load build definition from Dockerfile 0.0s =\u003e =\u003e transferring dockerfile: 408B 0.0s =\u003e [internal] load .dockerignore 0.0s =\u003e =\u003e transferring context: 2B 0.0s =\u003e [internal] load metadata for docker.io/library/centos:centos7.9.2009 0.0s =\u003e CACHED [1/2] FROM docker.io/library/centos:centos7.9.2009 0.0s =\u003e [2/2] RUN curl -o /etc/yum.repos.d/CentOS-Base.repo https://mirrors.aliyun.com/repo/Centos-7.repo \u0026\u0026 sed -i -e /mirrors.clou 72.2s =\u003e exporting to image 3.8s =\u003e =\u003e exporting layers 3.8s =\u003e =\u003e writing image sha256:30f266dbdecb307db7ee31297d333ae19a88f4add15bfd52f17bc6acfeea13f8 0.0s =\u003e =\u003e naming to docker.io/library/centos7:v2 # 查看结果 [root@demo ~]# docker images | grep v2 centos7 v2 30f266dbdecb 3 minutes ago 463MB # 新镜像安装了vim，查看 [root@demo ~]# docker run -it --rm centos7:v2 whereis vim vim: /usr/bin/vim /usr/share/vim # 基于新镜像运行容器输出了hello [root@demo ~]# docker run -it centos7:v2 hello 实例2-构建Tomcat # 准备Dockerfile [root@demo ~]# vim Dockerfile # 基础镜像centos:centos7.9.2009 FROM centos:centos7.9.2009 # 作者签名 MAINTAINER deemoprobe # 拷贝宿主机当前目录下文件 COPY tomcat.txt /usr/local/tomcat8.txt # 添加Tomcat安装包并解压至/usr/local ADD apache-tomcat-8.5.53.tar.gz /usr/local # 添加jdk安装包并解压至/usr/local ADD jdk-8u271-linux-x64.tar.gz /usr/local # 安装vim RUN curl -o /etc/yum.repos.d/CentOS-Base.repo https://mirrors.aliyun.com/repo/Centos-7.repo \u0026\u0026 sed -i -e '/mirrors.cloud.aliyuncs.com/d' -e '/mirrors.aliyuncs.com/d' /etc/yum.repos.d/CentOS-Base.repo \u0026\u0026 yum install vim -y # 设置环境变量 ENV MYPATH /usr/local # 指定工作目录，使用ENV设定的环境变量 WORKDIR $MYPATH # 配置JDK环境 ENV JAVA_HOME /usr/local/jdk1.8.0_271 ENV CLASSPATH $JAVA_HOME/lib/dt.jar:$JAVA_HOME/lib/tools.jar ENV CATALINA_HOME /usr/local/apache-tomcat-8.5.53 ENV CATALINA_BASE /usr/local/apache-tomcat-8.5.53 ENV PATH $PATH:$JAVA_HOME/bin:$CATALINA_HOME/lib:$CATALINA_HOME/bin # 声明端口8080 EXPOSE 8080 # 启动 # ENTRYPOINT [ \"/usr/local/apache-tomcat-8.5.53/bin/startup.sh\" ] # CMD [ \"/usr/local/apache-tomcat-8.5.53/bin/catalina.sh\", \"run\" ] CMD /usr/local/apache-tomcat-8.5.53/bin/startup.sh \u0026\u0026 tail -F /usr/local/apache-tomcat-8.5.53/bin/logs/catalina.out # 准备必要的文件到当前目录 [root@demo ~]# echo \"tomcat\" \u003e\u003e tomcat.txt # 上传Tomcat和jdk安装包 [root@demo ~]# ls apache-tomcat-8.5.53.tar.gz Dockerfile jdk-8u271-linux-x64.tar.gz tomcat.txt # 构建镜像 [root@demo ~]# docker build -t tomcat8:v1 . [+] Building 50.1s (9/10) =\u003e [internal] load build definition from Dockerfile 0.0s =\u003e =\u003e transferring dockerfile: 1.20kB 0.0s =\u003e [internal] load .dockerignore 0.0s =\u003e =\u003e transferring context: 2B 0.0s =\u003e [internal] load metadata for docker.io/library/centos:centos7.9.2009 0.0s =\u003e CACHED [1/6] FROM docker.io/library/centos:centos7.9.2009 0.0s =\u003e [internal] load build context 4.0s =\u003e =\u003e transferring context: 153.48MB 4.0s =\u003e [2/6] COPY tomcat.txt /usr/local/tomcat8.txt 0.3s =\u003e [3/6] ADD apache-tomcat-8.5.53.tar.gz /usr/local 1.2s =\u003e [4/6] ADD jdk-8u271-linux-x64.tar.gz /usr/local 7.6s =\u003e [5/6] RUN curl -o /etc/yum.repos.d/CentOS-Base.repo https://mirrors.aliyun.com/repo/Centos-7.repo \u0026\u0026 sed -i -e /mirrors.clou 48.0s =\u003e [6/6] WORKDIR /usr/local 0.0s =\u003e exporting to image 4.9s =\u003e =\u003e exporting layers 4.9s =\u003e =\u003e writing image sha256:dbccbeed821449bb611ff35b3071547035d925775a8b9d566e888ef6f895c3cf 0.0s =\u003e =\u003e naming to docker.io/library/tomcat8:v1 0.0s # 查看结果 [root@demo ~]# docker images | grep tomcat tomcat8 v1 dbccbeed8214 About a minute ago 833MB # 运行一个容器 # 如果有读写权限问题可以加上--privileged=true [root@demo ~]# docker run -d -p 1080:8080 --name myweb -v /root/web:/usr/local/apache-tomcat-8.5.53/webapps/web -v /root/tomcatlog:/usr/local/apache-tomcat-8.5.53/logs --privileged=true tomcat8:v1 d5f63d3513ba696e54fd7353e52d15a7c2582101d1c71067028c6251f2d82bef [root@demo ~]# docker ps | grep tomcat d5f63d3513ba tomcat8:v1 \"/bin/sh -c '/usr/lo…\" 17 seconds ago Up 15 seconds 0.0.0.0:1080-\u003e8080/tcp, :::1080-\u003e8080/tcp myweb # 访问Tomcat首页，直接 curl localhost:1080 可以看到返回Tomcat首页的HTML源码 [root@demo ~]# curl -I localhost:1080 HTTP/1.1 200 Content-Type: text/html;charset=UTF-8 Transfer-Encoding: chunked Date: Mon, 10 Jan 2022 10:38:12 GMT # 查看WORKDIR [root@demo ~]# docker exec d5f63d3513ba pwd /usr/local # 查看JDK版本 [root@demo ~]# docker exec d5f63d3513ba java -version java version \"1.8.0_271\" Java(TM) SE Runtime Environment (build 1.8.0_271-b09) Java HotSpot(TM) 64-Bit Server VM (build 25.271-b09, mixed mode) # 创建web项目，发布服务 [root@demo ~]# ls -l total 149860 -rw-r--r--. 1 root root 10300600 Jan 10 2022 apache-tomcat-8.5.53.tar.gz -rw-r--r--. 1 root root 1073 Jan 10 18:04 Dockerfile -rw-r--r--. 1 root root 143142634 Jan 10 2022 jdk-8u271-linux-x64.tar.gz drwxr-xr-x. 2 root root 197 Jan 10 18:36 tomcatlog -rw-r--r--. 1 root root 7 Jan 10 18:06 tomcat.txt drwxr-xr-x. 2 root root 6 Jan 10 18:36 web [root@demo ~]# cd web [root@demo web]# vim web.jsp \u003c%@ page language=\"java\" contentType=\"text/html; charset=UTF-8\" pageEncoding=\"UTF-8\"%\u003e \u003c!DOCTYPE html PUBLIC \"-//W3C//DTD HTML 4.01 Transitional//EN\" \"http://www.w3.org/TR/html4/loose.dtd\"\u003e ",
  "wordCount" : "3060",
  "inLanguage": "en",
  "image":"https://deemoprobe.github.io/img/docker.png","datePublished": "2023-04-26T14:52:37+08:00",
  "dateModified": "2023-04-26T14:52:37+08:00",
  "author":[{
    "@type": "Person",
    "name": "deemoprobe"
  }],
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://deemoprobe.github.io/posts/tech/docker/dockerfilegrammer/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "William's Blog",
    "logo": {
      "@type": "ImageObject",
      "url": "https://deemoprobe.github.io/img/favicon/favicon.ico"
    }
  }
}
</script>
</head>

<body class="" id="top">
<script>
    (function () {
        let  arr,reg = new RegExp("(^| )"+"change-themes"+"=([^;]*)(;|$)");
        if(arr = document.cookie.match(reg)) {
        } else {
            if (new Date().getHours() >= 19 || new Date().getHours() < 6) {
                document.body.classList.add('dark');
                localStorage.setItem("pref-theme", 'dark');
            } else {
                document.body.classList.remove('dark');
                localStorage.setItem("pref-theme", 'light');
            }
        }
    })()

    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }
</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="https://deemoprobe.github.io/" accesskey="h" title="Background (Alt + H)">Background</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                         fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                         stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                         fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                         stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="https://deemoprobe.github.io/" title="🏠 主页">
                <span>🏠 主页</span>
                </a>
            </li>
            <li>
                <a href="https://deemoprobe.github.io/tags" title="🎨 标签">
                <span>🎨 标签</span>
                </a>
            </li>
            <li>
                <a href="https://deemoprobe.github.io/archives/" title="📈 归档">
                <span>📈 归档</span>
                </a>
            </li>
            <li>
                <a href="https://deemoprobe.github.io/tools" title="🪁 工具">
                <span>🪁 工具</span>
                </a>
            </li>
            <li>
                <a href="https://wangchujiang.com/linux-command/" title="🐧 命令">
                <span>🐧 命令</span>
                </a>
            </li>
            <li>
                <a href="https://deemoprobe.github.io/search" title="🔍 搜索 (Alt &#43; /)" accesskey=/>
                <span>🔍 搜索</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main page">
<style>
    i[id*="post_meta_style"] {
        display: flex;
        align-items: center;
        margin: 0 0 10px 0;
    }
</style>

<article class="post-single">
    <div id="single-content">
        <header class="post-header">
            
            <h1 class="post-title">
                DockerfileGrammer
            </h1>
            <div class="post-description">
                Dockerfile语法，构建以及实例分析
            </div>
            <div class="post-meta">

<style>
    i[id*="post_meta_style"] {
        display: flex;
        align-items: center;
        margin: 0 0 10px 0;
    }

    .parent-post-meta {
        display: flex;
        flex-wrap: wrap;
        opacity: 0.8;
    }
</style>

<span class="parent-post-meta">
    <span id="post_meta_style_1">
        <span class="fa fa-calendar-check-o"></span>
        <span>2023-04-26
            &nbsp;&nbsp;
        </span>
    </span>
    
    
    
    
    
    
    
    <span id="post_meta_style_3">
        <span class="fa fa-file-word-o"></span>
        <span>3060字
            &nbsp;&nbsp;
        </span>
    </span>
    <span id="post_meta_style_4">
        <span class="fa fa-clock-o"></span>
        <span>7分钟
            &nbsp;&nbsp;
        </span>
    </span>
    <span id="post_meta_style_5">
        <span class="fa fa-user-o"></span>
        <span>deemoprobe
            &nbsp;&nbsp;
        </span>
    </span>
    <span id="post_meta_style_6">
        <span class="fa fa-tags" style="opacity: 0.8"></span>
        <span>
            <span class="post-tags-meta">
                <a href="https://deemoprobe.github.io/tags/docker/" style="color: var(--secondary)!important;">docker</a>
            </span>
        </span>
    </span>
</span>
<span style="opacity: 0.8;">
                    <span id="post_meta_style_7">
                        &nbsp;&nbsp;
                        <span class="fa fa-eye" ></span>
                        <span>
                            <span id="busuanzi_container_page_pv"><span id="busuanzi_value_page_pv"></span></span>
                            &nbsp;&nbsp;
                        </span>
                    </span>
                    
                </span>

</div>
        </header> 
<figure class="entry-cover1"><img style="zoom:;" loading="lazy" src="https://deemoprobe.github.io/img/docker.png" alt="">
    
</figure><aside id="toc-container" class="toc-container wide">
    <div class="toc">
        <details  open>
        <summary accesskey="c" title="(Alt + C)">
            <span class="details">文章目录</span>
        </summary>

        <div class="inner"><ul>
                <li>
                    <a href="#%e5%ad%97%e6%ae%b5%e8%a7%a3%e6%9e%90" aria-label="字段解析">字段解析</a><ul>
                        
                <li>
                    <a href="#%e7%ae%80%e4%bb%8b" aria-label="简介">简介</a></li></ul>
                </li>
                <li>
                    <a href="#%e5%ae%9e%e4%be%8b1-%e7%ae%80%e5%8d%95%e5%b0%9d%e8%af%95" aria-label="实例1-简单尝试">实例1-简单尝试</a></li>
                <li>
                    <a href="#%e5%ae%9e%e4%be%8b2-%e6%9e%84%e5%bb%batomcat" aria-label="实例2-构建Tomcat">实例2-构建Tomcat</a>
                </li>
            </ul>
        </div>
        </details>
    </div>
</aside>
<script>
    let activeElement;
    let elements;
    window.addEventListener('DOMContentLoaded', function (event) {
        checkTocPosition();

        elements = document.querySelectorAll('h1[id],h2[id],h3[id],h4[id],h5[id],h6[id]');
        
        activeElement = elements[0];
        const id = encodeURI(activeElement.getAttribute('id')).toLowerCase();
        document.querySelector(`.inner ul li a[href="#${id}"]`).classList.add('active');
    }, false);

    window.addEventListener('resize', function(event) {
        checkTocPosition();
    }, false);

    window.addEventListener('scroll', () => {
        
        activeElement = Array.from(elements).find((element) => {
            if ((getOffsetTop(element) - window.pageYOffset) > 0 &&
                (getOffsetTop(element) - window.pageYOffset) < window.innerHeight/2) {
                return element;
            }
        }) || activeElement

        elements.forEach(element => {
            const id = encodeURI(element.getAttribute('id')).toLowerCase();
            if (element === activeElement){
                document.querySelector(`.inner ul li a[href="#${id}"]`).classList.add('active');
            } else {
                document.querySelector(`.inner ul li a[href="#${id}"]`).classList.remove('active');
            }
        })
    }, false);

    const main = parseInt(getComputedStyle(document.body).getPropertyValue('--article-width'), 10);
    const toc = parseInt(getComputedStyle(document.body).getPropertyValue('--toc-width'), 10);
    const gap = parseInt(getComputedStyle(document.body).getPropertyValue('--gap'), 10);

    function checkTocPosition() {
        const width = document.body.scrollWidth;
        if (width - main - (toc * 2) - (gap * 4) > 0) {
            document.getElementById("toc-container").classList.add("wide");
        } else {
            document.getElementById("toc-container").classList.remove("wide");
        }
    }

    function getOffsetTop(element) {
        if (!element.getClientRects().length) {
            return 0;
        }
        let rect = element.getBoundingClientRect();
        let win = element.ownerDocument.defaultView;
        return rect.top + win.pageYOffset;
    }
</script>
        <div class="post-content"><h2 id="字段解析">字段解析<a hidden class="anchor" aria-hidden="true" href="#字段解析">#</a></h2>
<p><img loading="lazy" src="https://deemoprobe.oss-cn-shanghai.aliyuncs.com/images/dockerfs.png" alt="dockerfs"  />
</p>
<h3 id="简介">简介<a hidden class="anchor" aria-hidden="true" href="#简介">#</a></h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e"># 主要字段</span>
</span></span><span style="display:flex;"><span>FROM image<span style="color:#f92672">[</span>基础镜像,该文件创建新镜像所依赖的镜像<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>MAINTAINER user&lt;email&gt;<span style="color:#f92672">[</span>作者姓名和邮箱<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>RUN command<span style="color:#f92672">[</span>镜像构建时运行的命令<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>ADD <span style="color:#f92672">[</span>文件拷贝进镜像并解压<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>COPY <span style="color:#f92672">[</span>文件拷贝进镜像<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>CMD <span style="color:#f92672">[</span>容器启动时要运行的命令或参数<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>ENTRYPOINT <span style="color:#f92672">[</span>容器启动时要运行的命令<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>EXPOSE port<span style="color:#f92672">[</span>声明端口<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>WORKDIR work_directory<span style="color:#f92672">[</span>进入容器默认进入的目录<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>ENV set_env<span style="color:#f92672">[</span>创建环境变量<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>VOLUME <span style="color:#f92672">[</span>容器数据卷,用于数据保存和持久化<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>ONBUILD <span style="color:#f92672">[</span>当前Dockerfile构建时不会调用，当子镜像依赖本镜像（FROM）构建时触发ONBUILD后的命令<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>USER <span style="color:#f92672">[</span>指定构建镜像和运行容器的用户用户组<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>ARG <span style="color:#f92672">[</span>构建镜像时设定的变量<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>LABEL <span style="color:#f92672">[</span>为镜像添加元数据<span style="color:#f92672">]</span>
</span></span></code></pre></div><ul>
<li>FROM 基础镜像</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e"># 如果不指定版本，默认使用latest</span>
</span></span><span style="display:flex;"><span>FROM image
</span></span><span style="display:flex;"><span>FROM image:tag
</span></span><span style="display:flex;"><span>FROM image@digest
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 示例</span>
</span></span><span style="display:flex;"><span>FROM nginx:1.18.0
</span></span></code></pre></div><ul>
<li>MAINTAINER 作者</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>MAINTAINER user
</span></span><span style="display:flex;"><span>MAINTAINER email
</span></span><span style="display:flex;"><span>MAINTAINER user&lt;email&gt;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 示例</span>
</span></span><span style="display:flex;"><span>MAINTAINER deemo&lt;deemo@gmail.com&gt;
</span></span></code></pre></div><ul>
<li>RUN 构建镜像时执行的命令</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e"># Dockerfile里的指令每执行一次会在镜像文件系统中新建一层，为了避免多层文件造成镜像过大，多条命令写在一个RUN后面</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># RUN指令创建的中间镜像会被缓存，并会在下次构建中使用。如果不想使用这些缓存镜像，可以在构建时指定--no-cache参数，如：docker build --no-cache</span>
</span></span><span style="display:flex;"><span>RUN command
</span></span><span style="display:flex;"><span>RUN <span style="color:#f92672">[</span><span style="color:#e6db74">&#34;&lt;executable&gt;&#34;</span>,<span style="color:#e6db74">&#34;&lt;param1&gt;&#34;</span>,<span style="color:#e6db74">&#34;&lt;param2&gt;&#34;</span>,...<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 示例</span>
</span></span><span style="display:flex;"><span>RUN yum install -y curl
</span></span><span style="display:flex;"><span>RUN <span style="color:#f92672">[</span><span style="color:#e6db74">&#34;./test.php&#34;</span>,<span style="color:#e6db74">&#34;dev&#34;</span>,<span style="color:#e6db74">&#34;offline&#34;</span><span style="color:#f92672">]</span>  <span style="color:#75715e">#等价于 RUN ./test.php dev offline</span>
</span></span></code></pre></div><ul>
<li>ADD 本地文件拷贝进镜像，tar类型的会自动解压</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>ADD &lt;src&gt; &lt;dest&gt;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 示例</span>
</span></span><span style="display:flex;"><span>ADD file /dir/ <span style="color:#75715e">#添加file到/dir/目录</span>
</span></span><span style="display:flex;"><span>ADD file dir/ <span style="color:#75715e">#添加file到{WORKDIR}/dir目录</span>
</span></span><span style="display:flex;"><span>ADD <span style="color:#66d9ef">fi</span>* /dir <span style="color:#75715e">#通配符，添加所有以fi开头的文件到/dir/目录</span>
</span></span></code></pre></div><ul>
<li>COPY 本地文件拷贝进镜像，但不会解压</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>COPY &lt;src&gt; &lt;dest&gt;
</span></span></code></pre></div><ul>
<li>CMD 容器启动时（docker run时）要运行的命令或参数</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e"># 可以设置多个CMD,但最后一个生效,前面的不生效,也可以被docker run启动容器时后面加的命令替换</span>
</span></span><span style="display:flex;"><span>CMD <span style="color:#f92672">[</span><span style="color:#e6db74">&#34;&lt;executable&gt;&#34;</span>,<span style="color:#e6db74">&#34;&lt;param1&gt;&#34;</span>,<span style="color:#e6db74">&#34;&lt;param2&gt;&#34;</span>,...<span style="color:#f92672">]</span> <span style="color:#75715e">#执行可执行文件</span>
</span></span><span style="display:flex;"><span>CMD <span style="color:#f92672">[</span><span style="color:#e6db74">&#34;&lt;param1&gt;&#34;</span>,<span style="color:#e6db74">&#34;&lt;param2&gt;&#34;</span>,...<span style="color:#f92672">]</span> <span style="color:#75715e">#已设置ENTRYPOINT，则调用ENTRYPOINT后添加CMD参数</span>
</span></span><span style="display:flex;"><span>CMD command param1 param2 ... <span style="color:#75715e">#执行shell内部命令</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 示例</span>
</span></span><span style="display:flex;"><span>CMD <span style="color:#f92672">[</span><span style="color:#e6db74">&#34;/usr/bin/ls&#34;</span>,<span style="color:#e6db74">&#34;-al&#34;</span><span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>CMD echo <span style="color:#e6db74">&#34;hello&#34;</span>
</span></span></code></pre></div><ul>
<li>ENTRYPOINT 容器启动时要运行的命令</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e"># 类似于CMD指令，但其不会被docker run的命令行参数指定的指令所覆盖</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 存在多个ENTRYPOINT时，仅最后一个生效</span>
</span></span><span style="display:flex;"><span>ENTRYPOINT <span style="color:#f92672">[</span><span style="color:#e6db74">&#34;&lt;executeable&gt;&#34;</span>,<span style="color:#e6db74">&#34;&lt;param1&gt;&#34;</span>,<span style="color:#e6db74">&#34;&lt;param2&gt;&#34;</span>,...<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 示例</span>
</span></span><span style="display:flex;"><span>ENTRYPOINT <span style="color:#f92672">[</span><span style="color:#e6db74">&#34;nginx&#34;</span>, <span style="color:#e6db74">&#34;-c&#34;</span><span style="color:#f92672">]</span> <span style="color:#75715e">#定参</span>
</span></span><span style="display:flex;"><span>CMD <span style="color:#f92672">[</span><span style="color:#e6db74">&#34;/etc/nginx/nginx.conf&#34;</span><span style="color:#f92672">]</span> <span style="color:#75715e">#变参</span>
</span></span></code></pre></div><ul>
<li>EXPOSE 声明容器端口</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e"># EXPOSE仅是声明端口。要使其可访问，需要在docker run运行容器时通过-p来指定端口映射，或通过-P参数来映射EXPOSE端口</span>
</span></span><span style="display:flex;"><span>EXPOSE &lt;port&gt; <span style="color:#f92672">[</span>&lt;port&gt;...<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 示例</span>
</span></span><span style="display:flex;"><span>EXPOSE <span style="color:#ae81ff">80</span>
</span></span><span style="display:flex;"><span>EXPOSE <span style="color:#ae81ff">80</span> <span style="color:#ae81ff">443</span>
</span></span></code></pre></div><ul>
<li>WORKDIR 工作目录</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>WORKDIR path
</span></span></code></pre></div><ul>
<li>ENV 设置环境变量</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>ENV &lt;key&gt; &lt;value&gt;
</span></span><span style="display:flex;"><span>ENV &lt;key&gt;<span style="color:#f92672">=</span>&lt;value&gt; ...
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 示例</span>
</span></span><span style="display:flex;"><span>ENV dir<span style="color:#f92672">=</span>/webapp
</span></span><span style="display:flex;"><span>ENV name deemoprobe
</span></span></code></pre></div><ul>
<li>VOLUME 容器数据卷,用于数据保存和持久化</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>VOLUME <span style="color:#f92672">[</span><span style="color:#e6db74">&#34;/path/to/dir&#34;</span><span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 示例</span>
</span></span><span style="display:flex;"><span>VOLUME <span style="color:#f92672">[</span><span style="color:#e6db74">&#34;/data&#34;</span><span style="color:#f92672">]</span>
</span></span></code></pre></div><ul>
<li>USER 指定构建镜像和运行容器的用户用户组</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>USER user
</span></span><span style="display:flex;"><span>USER user:group
</span></span><span style="display:flex;"><span>USER uid
</span></span><span style="display:flex;"><span>USER uid:gid
</span></span><span style="display:flex;"><span>USER user:gid
</span></span><span style="display:flex;"><span>USER uid:group
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 示例</span>
</span></span><span style="display:flex;"><span>USER www
</span></span><span style="display:flex;"><span>USER 1080:tomcat
</span></span></code></pre></div><ul>
<li>ARG 构建镜像时设定的变量</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e"># 与 ENV 作用一致。不过作用域不一样。ARG 设置的环境变量仅对 Dockerfile 内有效，也就是说只有 docker build 的过程中有效，构建好的镜像内不存在此环境变量。</span>
</span></span><span style="display:flex;"><span>ARG &lt;name&gt;<span style="color:#f92672">[=</span>&lt;default value&gt;<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 示例</span>
</span></span><span style="display:flex;"><span>ARG user<span style="color:#f92672">=</span>www
</span></span></code></pre></div><ul>
<li>ONBUILD 当构建一个被继承的Dockerfile时运行命令</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e"># 子镜像构建时触发命令并执行。就是Dockerfile里用ONBUILD指定的命令，在本次构建镜像（假设镜像名为test）的过程中不会执行。当有新的Dockerfile使用了该镜像（FROM test），这时执行新镜像的Dockerfile构建时候，会执行test镜像中Dockerfile里的ONBUILD指定的命令。</span>
</span></span><span style="display:flex;"><span>ONBUILD <span style="color:#f92672">[</span>INSTRUCTION<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 示例</span>
</span></span><span style="display:flex;"><span>ONBUILD RUN yum install wget
</span></span><span style="display:flex;"><span>ONBUILD ADD . /data
</span></span></code></pre></div><ul>
<li>LABEL 为镜像添加元数据</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>LABEL &lt;key&gt;<span style="color:#f92672">=</span>&lt;value&gt; &lt;key&gt;<span style="color:#f92672">=</span>&lt;value&gt; &lt;key&gt;<span style="color:#f92672">=</span>&lt;value&gt; ...
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 示例</span>
</span></span><span style="display:flex;"><span>LABEL version<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;1.0&#34;</span> des<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;webapp&#34;</span>
</span></span></code></pre></div><h2 id="实例1-简单尝试">实例1-简单尝试<a hidden class="anchor" aria-hidden="true" href="#实例1-简单尝试">#</a></h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#f92672">[</span>root@demo ~<span style="color:#f92672">]</span><span style="color:#75715e"># docker build --help</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Usage:  docker build <span style="color:#f92672">[</span>OPTIONS<span style="color:#f92672">]</span> PATH | URL | -
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Build an image from a Dockerfile
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Options:
</span></span><span style="display:flex;"><span>      --add-host list           Add a custom host-to-IP mapping <span style="color:#f92672">(</span>host:ip<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>      --build-arg list          Set build-time variables
</span></span><span style="display:flex;"><span>      --cache-from strings      Images to consider as cache sources
</span></span><span style="display:flex;"><span>      --cgroup-parent string    Optional parent cgroup <span style="color:#66d9ef">for</span> the container
</span></span><span style="display:flex;"><span>      --compress                Compress the build context using gzip
</span></span><span style="display:flex;"><span>      --cpu-period int          Limit the CPU CFS <span style="color:#f92672">(</span>Completely Fair Scheduler<span style="color:#f92672">)</span> period
</span></span><span style="display:flex;"><span>      --cpu-quota int           Limit the CPU CFS <span style="color:#f92672">(</span>Completely Fair Scheduler<span style="color:#f92672">)</span> quota
</span></span><span style="display:flex;"><span>  -c, --cpu-shares int          CPU shares <span style="color:#f92672">(</span>relative weight<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>      --cpuset-cpus string      CPUs in which to allow execution <span style="color:#f92672">(</span>0-3, 0,1<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>      --cpuset-mems string      MEMs in which to allow execution <span style="color:#f92672">(</span>0-3, 0,1<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>      --disable-content-trust   Skip image verification <span style="color:#f92672">(</span>default true<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>  -f, --file string             Name of the Dockerfile <span style="color:#f92672">(</span>Default is <span style="color:#e6db74">&#39;PATH/Dockerfile&#39;</span><span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>      --force-rm                Always remove intermediate containers
</span></span><span style="display:flex;"><span>      --iidfile string          Write the image ID to the file
</span></span><span style="display:flex;"><span>      --isolation string        Container isolation technology
</span></span><span style="display:flex;"><span>      --label list              Set metadata <span style="color:#66d9ef">for</span> an image
</span></span><span style="display:flex;"><span>  -m, --memory bytes            Memory limit
</span></span><span style="display:flex;"><span>      --memory-swap bytes       Swap limit equal to memory plus swap: <span style="color:#e6db74">&#39;-1&#39;</span> to enable unlimited swap
</span></span><span style="display:flex;"><span>      --network string          Set the networking mode <span style="color:#66d9ef">for</span> the RUN instructions during build <span style="color:#f92672">(</span>default <span style="color:#e6db74">&#34;default&#34;</span><span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>      --no-cache                Do not use cache when building the image
</span></span><span style="display:flex;"><span>      --pull                    Always attempt to pull a newer version of the image
</span></span><span style="display:flex;"><span>  -q, --quiet                   Suppress the build output and print image ID on success
</span></span><span style="display:flex;"><span>      --rm                      Remove intermediate containers after a successful build <span style="color:#f92672">(</span>default true<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>      --security-opt strings    Security options
</span></span><span style="display:flex;"><span>      --shm-size bytes          Size of /dev/shm
</span></span><span style="display:flex;"><span>  -t, --tag list                Name and optionally a tag in the <span style="color:#e6db74">&#39;name:tag&#39;</span> format
</span></span><span style="display:flex;"><span>      --target string           Set the target build stage to build.
</span></span><span style="display:flex;"><span>      --ulimit ulimit           Ulimit options <span style="color:#f92672">(</span>default <span style="color:#f92672">[])</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 创建Dockerfile</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@demo ~<span style="color:#f92672">]</span><span style="color:#75715e"># cat Dockerfile</span>
</span></span><span style="display:flex;"><span>FROM centos:centos7.9.2009 <span style="color:#75715e"># 该镜像已经提前拉取</span>
</span></span><span style="display:flex;"><span>MAINTAINER deemo&lt;deemo@gmail.com&gt;
</span></span><span style="display:flex;"><span>RUN curl -o /etc/yum.repos.d/CentOS-Base.repo https://mirrors.aliyun.com/repo/Centos-7.repo <span style="color:#f92672">&amp;&amp;</span> sed -i -e <span style="color:#e6db74">&#39;/mirrors.cloud.aliyuncs.com/d&#39;</span> -e <span style="color:#e6db74">&#39;/mirrors.aliyuncs.com/d&#39;</span> /etc/yum.repos.d/CentOS-Base.repo <span style="color:#f92672">&amp;&amp;</span> yum install vim -y
</span></span><span style="display:flex;"><span>CMD <span style="color:#f92672">[</span><span style="color:#e6db74">&#34;/bin/echo&#34;</span>,<span style="color:#e6db74">&#34;hello&#34;</span><span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 对比父镜像和新镜像，有sed和curl没有vim</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@demo ~<span style="color:#f92672">]</span><span style="color:#75715e"># docker run -it --rm centos:centos7.9.2009 whereis sed</span>
</span></span><span style="display:flex;"><span>sed: /usr/bin/sed
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@demo ~<span style="color:#f92672">]</span><span style="color:#75715e"># docker run -it --rm centos:centos7.9.2009 whereis curl</span>
</span></span><span style="display:flex;"><span>curl: /usr/bin/curl
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@demo ~<span style="color:#f92672">]</span><span style="color:#75715e"># docker run -it --rm centos:centos7.9.2009 whereis vim</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 构建镜像</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@demo ~<span style="color:#f92672">]</span><span style="color:#75715e"># docker build -t centos7:v2 .</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>+<span style="color:#f92672">]</span> Building 76.1s <span style="color:#f92672">(</span>6/6<span style="color:#f92672">)</span> FINISHED
</span></span><span style="display:flex;"><span> <span style="color:#f92672">=</span>&gt; <span style="color:#f92672">[</span>internal<span style="color:#f92672">]</span> load build definition from Dockerfile                                                                                0.0s
</span></span><span style="display:flex;"><span> <span style="color:#f92672">=</span>&gt; <span style="color:#f92672">=</span>&gt; transferring dockerfile: 408B                                                                                                0.0s
</span></span><span style="display:flex;"><span> <span style="color:#f92672">=</span>&gt; <span style="color:#f92672">[</span>internal<span style="color:#f92672">]</span> load .dockerignore                                                                                                   0.0s
</span></span><span style="display:flex;"><span> <span style="color:#f92672">=</span>&gt; <span style="color:#f92672">=</span>&gt; transferring context: 2B                                                                                                     0.0s
</span></span><span style="display:flex;"><span> <span style="color:#f92672">=</span>&gt; <span style="color:#f92672">[</span>internal<span style="color:#f92672">]</span> load metadata <span style="color:#66d9ef">for</span> docker.io/library/centos:centos7.9.2009                                                            0.0s
</span></span><span style="display:flex;"><span> <span style="color:#f92672">=</span>&gt; CACHED <span style="color:#f92672">[</span>1/2<span style="color:#f92672">]</span> FROM docker.io/library/centos:centos7.9.2009                                                                       0.0s
</span></span><span style="display:flex;"><span> <span style="color:#f92672">=</span>&gt; <span style="color:#f92672">[</span>2/2<span style="color:#f92672">]</span> RUN curl -o /etc/yum.repos.d/CentOS-Base.repo https://mirrors.aliyun.com/repo/Centos-7.repo <span style="color:#f92672">&amp;&amp;</span> sed -i -e /mirrors.clou   72.2s
</span></span><span style="display:flex;"><span> <span style="color:#f92672">=</span>&gt; exporting to image                                                                                                              3.8s
</span></span><span style="display:flex;"><span> <span style="color:#f92672">=</span>&gt; <span style="color:#f92672">=</span>&gt; exporting layers                                                                                                             3.8s
</span></span><span style="display:flex;"><span> <span style="color:#f92672">=</span>&gt; <span style="color:#f92672">=</span>&gt; writing image sha256:30f266dbdecb307db7ee31297d333ae19a88f4add15bfd52f17bc6acfeea13f8                                        0.0s
</span></span><span style="display:flex;"><span> <span style="color:#f92672">=</span>&gt; <span style="color:#f92672">=</span>&gt; naming to docker.io/library/centos7:v2 
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 查看结果</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@demo ~<span style="color:#f92672">]</span><span style="color:#75715e"># docker images | grep v2</span>
</span></span><span style="display:flex;"><span>centos7                     v2               30f266dbdecb   <span style="color:#ae81ff">3</span> minutes ago    463MB
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 新镜像安装了vim，查看</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@demo ~<span style="color:#f92672">]</span><span style="color:#75715e"># docker run -it --rm centos7:v2 whereis vim</span>
</span></span><span style="display:flex;"><span>vim: /usr/bin/vim /usr/share/vim
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 基于新镜像运行容器输出了hello</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@demo ~<span style="color:#f92672">]</span><span style="color:#75715e"># docker run -it centos7:v2</span>
</span></span><span style="display:flex;"><span>hello
</span></span></code></pre></div><h2 id="实例2-构建tomcat">实例2-构建Tomcat<a hidden class="anchor" aria-hidden="true" href="#实例2-构建tomcat">#</a></h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e"># 准备Dockerfile</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@demo ~<span style="color:#f92672">]</span><span style="color:#75715e"># vim Dockerfile </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 基础镜像centos:centos7.9.2009</span>
</span></span><span style="display:flex;"><span>FROM centos:centos7.9.2009
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 作者签名</span>
</span></span><span style="display:flex;"><span>MAINTAINER deemoprobe&lt;deemoprobe@gmail.com&gt;
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 拷贝宿主机当前目录下文件</span>
</span></span><span style="display:flex;"><span>COPY tomcat.txt /usr/local/tomcat8.txt
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 添加Tomcat安装包并解压至/usr/local</span>
</span></span><span style="display:flex;"><span>ADD apache-tomcat-8.5.53.tar.gz /usr/local
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 添加jdk安装包并解压至/usr/local</span>
</span></span><span style="display:flex;"><span>ADD jdk-8u271-linux-x64.tar.gz /usr/local
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 安装vim</span>
</span></span><span style="display:flex;"><span>RUN curl -o /etc/yum.repos.d/CentOS-Base.repo https://mirrors.aliyun.com/repo/Centos-7.repo <span style="color:#f92672">&amp;&amp;</span> sed -i -e <span style="color:#e6db74">&#39;/mirrors.cloud.aliyuncs.com/d&#39;</span> -e <span style="color:#e6db74">&#39;/mirrors.aliyuncs.com/d&#39;</span> /etc/yum.repos.d/CentOS-Base.repo <span style="color:#f92672">&amp;&amp;</span> yum install vim -y
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 设置环境变量</span>
</span></span><span style="display:flex;"><span>ENV MYPATH /usr/local
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 指定工作目录，使用ENV设定的环境变量</span>
</span></span><span style="display:flex;"><span>WORKDIR $MYPATH
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 配置JDK环境</span>
</span></span><span style="display:flex;"><span>ENV JAVA_HOME /usr/local/jdk1.8.0_271
</span></span><span style="display:flex;"><span>ENV CLASSPATH $JAVA_HOME/lib/dt.jar:$JAVA_HOME/lib/tools.jar
</span></span><span style="display:flex;"><span>ENV CATALINA_HOME /usr/local/apache-tomcat-8.5.53
</span></span><span style="display:flex;"><span>ENV CATALINA_BASE /usr/local/apache-tomcat-8.5.53
</span></span><span style="display:flex;"><span>ENV PATH $PATH:$JAVA_HOME/bin:$CATALINA_HOME/lib:$CATALINA_HOME/bin
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 声明端口8080</span>
</span></span><span style="display:flex;"><span>EXPOSE <span style="color:#ae81ff">8080</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 启动</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ENTRYPOINT [ &#34;/usr/local/apache-tomcat-8.5.53/bin/startup.sh&#34; ]</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># CMD [ &#34;/usr/local/apache-tomcat-8.5.53/bin/catalina.sh&#34;, &#34;run&#34; ]</span>
</span></span><span style="display:flex;"><span>CMD /usr/local/apache-tomcat-8.5.53/bin/startup.sh <span style="color:#f92672">&amp;&amp;</span> tail -F /usr/local/apache-tomcat-8.5.53/bin/logs/catalina.out
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 准备必要的文件到当前目录</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@demo ~<span style="color:#f92672">]</span><span style="color:#75715e"># echo &#34;tomcat&#34; &gt;&gt; tomcat.txt</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 上传Tomcat和jdk安装包</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@demo ~<span style="color:#f92672">]</span><span style="color:#75715e"># ls</span>
</span></span><span style="display:flex;"><span>apache-tomcat-8.5.53.tar.gz  Dockerfile  jdk-8u271-linux-x64.tar.gz  tomcat.txt
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 构建镜像</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@demo ~<span style="color:#f92672">]</span><span style="color:#75715e"># docker build -t tomcat8:v1 .</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>+<span style="color:#f92672">]</span> Building 50.1s <span style="color:#f92672">(</span>9/10<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span> <span style="color:#f92672">=</span>&gt; <span style="color:#f92672">[</span>internal<span style="color:#f92672">]</span> load build definition from Dockerfile                                                                                0.0s
</span></span><span style="display:flex;"><span> <span style="color:#f92672">=</span>&gt; <span style="color:#f92672">=</span>&gt; transferring dockerfile: 1.20kB                                                                                              0.0s
</span></span><span style="display:flex;"><span> <span style="color:#f92672">=</span>&gt; <span style="color:#f92672">[</span>internal<span style="color:#f92672">]</span> load .dockerignore                                                                                                   0.0s
</span></span><span style="display:flex;"><span> <span style="color:#f92672">=</span>&gt; <span style="color:#f92672">=</span>&gt; transferring context: 2B                                                                                                     0.0s
</span></span><span style="display:flex;"><span> <span style="color:#f92672">=</span>&gt; <span style="color:#f92672">[</span>internal<span style="color:#f92672">]</span> load metadata <span style="color:#66d9ef">for</span> docker.io/library/centos:centos7.9.2009                                                            0.0s
</span></span><span style="display:flex;"><span> <span style="color:#f92672">=</span>&gt; CACHED <span style="color:#f92672">[</span>1/6<span style="color:#f92672">]</span> FROM docker.io/library/centos:centos7.9.2009                                                                       0.0s
</span></span><span style="display:flex;"><span> <span style="color:#f92672">=</span>&gt; <span style="color:#f92672">[</span>internal<span style="color:#f92672">]</span> load build context                                                                                                   4.0s
</span></span><span style="display:flex;"><span> <span style="color:#f92672">=</span>&gt; <span style="color:#f92672">=</span>&gt; transferring context: 153.48MB                                                                                               4.0s
</span></span><span style="display:flex;"><span> <span style="color:#f92672">=</span>&gt; <span style="color:#f92672">[</span>2/6<span style="color:#f92672">]</span> COPY tomcat.txt /usr/local/tomcat8.txt                                                                                    0.3s
</span></span><span style="display:flex;"><span> <span style="color:#f92672">=</span>&gt; <span style="color:#f92672">[</span>3/6<span style="color:#f92672">]</span> ADD apache-tomcat-8.5.53.tar.gz /usr/local                                                                                1.2s
</span></span><span style="display:flex;"><span> <span style="color:#f92672">=</span>&gt; <span style="color:#f92672">[</span>4/6<span style="color:#f92672">]</span> ADD jdk-8u271-linux-x64.tar.gz /usr/local                                                                                 7.6s
</span></span><span style="display:flex;"><span> <span style="color:#f92672">=</span>&gt; <span style="color:#f92672">[</span>5/6<span style="color:#f92672">]</span> RUN curl -o /etc/yum.repos.d/CentOS-Base.repo https://mirrors.aliyun.com/repo/Centos-7.repo <span style="color:#f92672">&amp;&amp;</span> sed -i -e /mirrors.clou   48.0s
</span></span><span style="display:flex;"><span> <span style="color:#f92672">=</span>&gt; <span style="color:#f92672">[</span>6/6<span style="color:#f92672">]</span> WORKDIR /usr/local                                                                                                        0.0s
</span></span><span style="display:flex;"><span> <span style="color:#f92672">=</span>&gt; exporting to image                                                                                                              4.9s
</span></span><span style="display:flex;"><span> <span style="color:#f92672">=</span>&gt; <span style="color:#f92672">=</span>&gt; exporting layers                                                                                                             4.9s
</span></span><span style="display:flex;"><span> <span style="color:#f92672">=</span>&gt; <span style="color:#f92672">=</span>&gt; writing image sha256:dbccbeed821449bb611ff35b3071547035d925775a8b9d566e888ef6f895c3cf                                        0.0s
</span></span><span style="display:flex;"><span> <span style="color:#f92672">=</span>&gt; <span style="color:#f92672">=</span>&gt; naming to docker.io/library/tomcat8:v1                                                                                       0.0s
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 查看结果</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@demo ~<span style="color:#f92672">]</span><span style="color:#75715e"># docker images | grep tomcat</span>
</span></span><span style="display:flex;"><span>tomcat8                     v1               dbccbeed8214   About a minute ago   833MB
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 运行一个容器</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 如果有读写权限问题可以加上--privileged=true</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@demo ~<span style="color:#f92672">]</span><span style="color:#75715e"># docker run -d -p 1080:8080 --name myweb -v /root/web:/usr/local/apache-tomcat-8.5.53/webapps/web -v /root/tomcatlog:/usr/local/apache-tomcat-8.5.53/logs --privileged=true tomcat8:v1</span>
</span></span><span style="display:flex;"><span>d5f63d3513ba696e54fd7353e52d15a7c2582101d1c71067028c6251f2d82bef
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@demo ~<span style="color:#f92672">]</span><span style="color:#75715e"># docker ps | grep tomcat</span>
</span></span><span style="display:flex;"><span>d5f63d3513ba   tomcat8:v1                <span style="color:#e6db74">&#34;/bin/sh -c &#39;/usr/lo…&#34;</span>   <span style="color:#ae81ff">17</span> seconds ago   Up <span style="color:#ae81ff">15</span> seconds   0.0.0.0:1080-&gt;8080/tcp, :::1080-&gt;8080/tcp   myweb
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 访问Tomcat首页，直接 curl localhost:1080 可以看到返回Tomcat首页的HTML源码</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@demo ~<span style="color:#f92672">]</span><span style="color:#75715e"># curl -I localhost:1080</span>
</span></span><span style="display:flex;"><span>HTTP/1.1 <span style="color:#ae81ff">200</span> 
</span></span><span style="display:flex;"><span>Content-Type: text/html;charset<span style="color:#f92672">=</span>UTF-8
</span></span><span style="display:flex;"><span>Transfer-Encoding: chunked
</span></span><span style="display:flex;"><span>Date: Mon, <span style="color:#ae81ff">10</span> Jan <span style="color:#ae81ff">2022</span> 10:38:12 GMT
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 查看WORKDIR</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@demo ~<span style="color:#f92672">]</span><span style="color:#75715e"># docker exec d5f63d3513ba pwd</span>
</span></span><span style="display:flex;"><span>/usr/local
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 查看JDK版本</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@demo ~<span style="color:#f92672">]</span><span style="color:#75715e"># docker exec d5f63d3513ba java -version</span>
</span></span><span style="display:flex;"><span>java version <span style="color:#e6db74">&#34;1.8.0_271&#34;</span>
</span></span><span style="display:flex;"><span>Java<span style="color:#f92672">(</span>TM<span style="color:#f92672">)</span> SE Runtime Environment <span style="color:#f92672">(</span>build 1.8.0_271-b09<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>Java HotSpot<span style="color:#f92672">(</span>TM<span style="color:#f92672">)</span> 64-Bit Server VM <span style="color:#f92672">(</span>build 25.271-b09, mixed mode<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 创建web项目，发布服务</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@demo ~<span style="color:#f92672">]</span><span style="color:#75715e"># ls -l</span>
</span></span><span style="display:flex;"><span>total <span style="color:#ae81ff">149860</span>
</span></span><span style="display:flex;"><span>-rw-r--r--. <span style="color:#ae81ff">1</span> root root  <span style="color:#ae81ff">10300600</span> Jan <span style="color:#ae81ff">10</span>  <span style="color:#ae81ff">2022</span> apache-tomcat-8.5.53.tar.gz
</span></span><span style="display:flex;"><span>-rw-r--r--. <span style="color:#ae81ff">1</span> root root      <span style="color:#ae81ff">1073</span> Jan <span style="color:#ae81ff">10</span> 18:04 Dockerfile
</span></span><span style="display:flex;"><span>-rw-r--r--. <span style="color:#ae81ff">1</span> root root <span style="color:#ae81ff">143142634</span> Jan <span style="color:#ae81ff">10</span>  <span style="color:#ae81ff">2022</span> jdk-8u271-linux-x64.tar.gz
</span></span><span style="display:flex;"><span>drwxr-xr-x. <span style="color:#ae81ff">2</span> root root       <span style="color:#ae81ff">197</span> Jan <span style="color:#ae81ff">10</span> 18:36 tomcatlog
</span></span><span style="display:flex;"><span>-rw-r--r--. <span style="color:#ae81ff">1</span> root root         <span style="color:#ae81ff">7</span> Jan <span style="color:#ae81ff">10</span> 18:06 tomcat.txt
</span></span><span style="display:flex;"><span>drwxr-xr-x. <span style="color:#ae81ff">2</span> root root         <span style="color:#ae81ff">6</span> Jan <span style="color:#ae81ff">10</span> 18:36 web
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@demo ~<span style="color:#f92672">]</span><span style="color:#75715e"># cd web</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@demo web<span style="color:#f92672">]</span><span style="color:#75715e"># vim web.jsp</span>
</span></span><span style="display:flex;"><span>&lt;%@ page language<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;java&#34;</span> contentType<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;text/html; charset=UTF-8&#34;</span> pageEncoding<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;UTF-8&#34;</span>%&gt;
</span></span><span style="display:flex;"><span>&lt;!DOCTYPE html PUBLIC <span style="color:#e6db74">&#34;-//W3C//DTD HTML 4.01 Transitional//EN&#34;</span> <span style="color:#e6db74">&#34;http://www.w3.org/TR/html4/loose.dtd&#34;</span>&gt;
</span></span><span style="display:flex;"><span>&lt;html&gt;
</span></span><span style="display:flex;"><span>  &lt;head&gt;
</span></span><span style="display:flex;"><span>    &lt;meta http-equiv<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;Content-Type&#34;</span> content<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;text/html; charset=UTF-8&#34;</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;title&gt;Insert title here&lt;/title&gt;
</span></span><span style="display:flex;"><span>  &lt;/head&gt;
</span></span><span style="display:flex;"><span>  &lt;body&gt;
</span></span><span style="display:flex;"><span>    -----------welcome------------
</span></span><span style="display:flex;"><span>    &lt;%<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;I am in docker tomcat8&#34;</span>%&gt;
</span></span><span style="display:flex;"><span>    &lt;br&gt;
</span></span><span style="display:flex;"><span>    &lt;br&gt;
</span></span><span style="display:flex;"><span>    &lt;% System.out.println<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;=============docker tomcat8&#34;</span><span style="color:#f92672">)</span>;%&gt;
</span></span><span style="display:flex;"><span>  &lt;/body&gt;
</span></span><span style="display:flex;"><span>&lt;/html&gt;
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@demo web<span style="color:#f92672">]</span><span style="color:#75715e"># mkdir WEB-INF</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@demo web<span style="color:#f92672">]</span><span style="color:#75715e"># cd WEB-INF/</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@demo WEB-INF<span style="color:#f92672">]</span><span style="color:#75715e"># vim web.xml</span>
</span></span><span style="display:flex;"><span>&lt;?xml version<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;1.0&#34;</span> encoding<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;UTF-8&#34;</span>?&gt;
</span></span><span style="display:flex;"><span>&lt;web-app xmlns:xsi<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;http://www.w3.org/2001/XMLSchema-instance&#34;</span>
</span></span><span style="display:flex;"><span>  xmlns<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;http://java.sun.com/xml/ns/javaee&#34;</span>
</span></span><span style="display:flex;"><span>  xsi:schemaLocation<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;http://java.sun.com/xml/ns/javaee http://java.sun.com/xml/ns/javaee/web-app_2_5.xsd&#34;</span>
</span></span><span style="display:flex;"><span>  id<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;WebApp_ID&#34;</span> version<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;2.5&#34;</span>&gt;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  &lt;display-name&gt;test-tomcat8&lt;/display-name&gt;
</span></span><span style="display:flex;"><span>&lt;/web-app&gt;
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 查看项目结构</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@demo ~<span style="color:#f92672">]</span><span style="color:#75715e"># yum install tree -y</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@demo ~<span style="color:#f92672">]</span><span style="color:#75715e"># tree</span>
</span></span><span style="display:flex;"><span>.
</span></span><span style="display:flex;"><span>├── apache-tomcat-8.5.53.tar.gz
</span></span><span style="display:flex;"><span>├── Dockerfile
</span></span><span style="display:flex;"><span>├── jdk-8u271-linux-x64.tar.gz
</span></span><span style="display:flex;"><span>├── tomcatlog
</span></span><span style="display:flex;"><span>│   ├── catalina.2022-01-10.log
</span></span><span style="display:flex;"><span>│   ├── catalina.out
</span></span><span style="display:flex;"><span>│   ├── host-manager.2022-01-10.log
</span></span><span style="display:flex;"><span>│   ├── localhost.2022-01-10.log
</span></span><span style="display:flex;"><span>│   ├── localhost_access_log.2022-01-10.txt
</span></span><span style="display:flex;"><span>│   └── manager.2022-01-10.log
</span></span><span style="display:flex;"><span>├── tomcat.txt
</span></span><span style="display:flex;"><span>└── web
</span></span><span style="display:flex;"><span>    ├── WEB-INF
</span></span><span style="display:flex;"><span>    │   └── web.xml
</span></span><span style="display:flex;"><span>    └── web.jsp
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">3</span> directories, <span style="color:#ae81ff">12</span> files
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 查看容器内数据卷同步结果</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@centos7 WEB-INF<span style="color:#f92672">]</span><span style="color:#75715e"># docker ps | grep tomcat</span>
</span></span><span style="display:flex;"><span>d5f63d3513ba   tomcat8:v1                <span style="color:#e6db74">&#34;/bin/sh -c &#39;/usr/lo…&#34;</span>   <span style="color:#ae81ff">5</span> minutes ago   Up <span style="color:#ae81ff">4</span> minutes   0.0.0.0:1080-&gt;8080/tcp, :::1080-&gt;8080/tcp   myweb
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@demo ~<span style="color:#f92672">]</span><span style="color:#75715e"># docker exec d5f63d3513ba ls -l /usr/local/apache-tomcat-8.5.53/webapps/web</span>
</span></span><span style="display:flex;"><span>total <span style="color:#ae81ff">4</span>
</span></span><span style="display:flex;"><span>drwxr-xr-x. <span style="color:#ae81ff">2</span> root root  <span style="color:#ae81ff">21</span> Jan <span style="color:#ae81ff">10</span> 10:49 WEB-INF
</span></span><span style="display:flex;"><span>-rw-r--r--. <span style="color:#ae81ff">1</span> root root <span style="color:#ae81ff">500</span> Jan <span style="color:#ae81ff">10</span> 10:48 web.jsp
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@demo ~<span style="color:#f92672">]</span><span style="color:#75715e"># docker exec d5f63d3513ba ls -l /usr/local/apache-tomcat-8.5.53/logs</span>
</span></span><span style="display:flex;"><span>total <span style="color:#ae81ff">24</span>
</span></span><span style="display:flex;"><span>-rw-r-----. <span style="color:#ae81ff">1</span> root root <span style="color:#ae81ff">7173</span> Jan <span style="color:#ae81ff">10</span> 10:49 catalina.2022-01-10.log
</span></span><span style="display:flex;"><span>-rw-r-----. <span style="color:#ae81ff">1</span> root root <span style="color:#ae81ff">7173</span> Jan <span style="color:#ae81ff">10</span> 10:49 catalina.out
</span></span><span style="display:flex;"><span>-rw-r-----. <span style="color:#ae81ff">1</span> root root    <span style="color:#ae81ff">0</span> Jan <span style="color:#ae81ff">10</span> 10:36 host-manager.2022-01-10.log
</span></span><span style="display:flex;"><span>-rw-r-----. <span style="color:#ae81ff">1</span> root root  <span style="color:#ae81ff">459</span> Jan <span style="color:#ae81ff">10</span> 10:36 localhost.2022-01-10.log
</span></span><span style="display:flex;"><span>-rw-r-----. <span style="color:#ae81ff">1</span> root root  <span style="color:#ae81ff">281</span> Jan <span style="color:#ae81ff">10</span> 10:40 localhost_access_log.2022-01-10.txt
</span></span><span style="display:flex;"><span>-rw-r-----. <span style="color:#ae81ff">1</span> root root    <span style="color:#ae81ff">0</span> Jan <span style="color:#ae81ff">10</span> 10:36 manager.2022-01-10.log
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 重启一下容器</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@demo ~<span style="color:#f92672">]</span><span style="color:#75715e"># docker restart d5f63d3513ba</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 访问结果</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@demo ~<span style="color:#f92672">]</span><span style="color:#75715e"># curl localhost:1080/web/web.jsp</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>&lt;!DOCTYPE html PUBLIC <span style="color:#e6db74">&#34;-//W3C//DTD HTML 4.01 Transitional//EN&#34;</span> <span style="color:#e6db74">&#34;http://www.w3.org/TR/html4/loose.dtd&#34;</span>&gt;
</span></span><span style="display:flex;"><span>&lt;html&gt;
</span></span><span style="display:flex;"><span>  &lt;head&gt;
</span></span><span style="display:flex;"><span>    &lt;meta http-equiv<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;Content-Type&#34;</span> content<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;text/html; charset=UTF-8&#34;</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;title&gt;Insert title here&lt;/title&gt;
</span></span><span style="display:flex;"><span>  &lt;/head&gt;
</span></span><span style="display:flex;"><span>  &lt;body&gt;
</span></span><span style="display:flex;"><span>    -----------welcome------------
</span></span><span style="display:flex;"><span>    I am in docker tomcat8
</span></span><span style="display:flex;"><span>    &lt;br&gt;
</span></span><span style="display:flex;"><span>    &lt;br&gt;
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>  &lt;/body&gt;
</span></span><span style="display:flex;"><span>&lt;/html&gt;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 查看日志，可以看到访问记录，其他日志文件可以看到Tomcat启动记录等</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@demo ~<span style="color:#f92672">]</span><span style="color:#75715e"># cd tomcatlog/</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@demo tomcatlog<span style="color:#f92672">]</span><span style="color:#75715e"># cat localhost_access_log.2022-01-10.txt</span>
</span></span><span style="display:flex;"><span>172.17.0.1 - - <span style="color:#f92672">[</span>10/Jan/2022:10:38:12 +0000<span style="color:#f92672">]</span> <span style="color:#e6db74">&#34;HEAD / HTTP/1.1&#34;</span> <span style="color:#ae81ff">200</span> -
</span></span><span style="display:flex;"><span>172.17.0.1 - - <span style="color:#f92672">[</span>10/Jan/2022:10:38:21 +0000<span style="color:#f92672">]</span> <span style="color:#e6db74">&#34;GET / HTTP/1.1&#34;</span> <span style="color:#ae81ff">200</span> <span style="color:#ae81ff">11215</span>
</span></span><span style="display:flex;"><span>172.17.0.1 - - <span style="color:#f92672">[</span>10/Jan/2022:10:39:49 +0000<span style="color:#f92672">]</span> <span style="color:#e6db74">&#34;GET / HTTP/1.1&#34;</span> <span style="color:#ae81ff">200</span> <span style="color:#ae81ff">11215</span>
</span></span><span style="display:flex;"><span>172.17.0.1 - - <span style="color:#f92672">[</span>10/Jan/2022:10:39:56 +0000<span style="color:#f92672">]</span> <span style="color:#e6db74">&#34;GET / HTTP/1.1&#34;</span> <span style="color:#ae81ff">200</span> <span style="color:#ae81ff">11215</span>
</span></span><span style="display:flex;"><span>172.17.0.1 - - <span style="color:#f92672">[</span>10/Jan/2022:10:58:16 +0000<span style="color:#f92672">]</span> <span style="color:#e6db74">&#34;GET /web/web.jsp HTTP/1.1&#34;</span> <span style="color:#ae81ff">200</span> <span style="color:#ae81ff">352</span>
</span></span></code></pre></div><blockquote>
<p>参考文档：<a href="https://github.com/docker-library"  target="_blank" rel="noopener" style="color:#42b983" ;>Docker官方镜像库示例</a></p>
</blockquote>


        </div>

        <footer class="post-footer">
            
<nav class="paginav">
  <a class="prev" href="https://deemoprobe.github.io/posts/tech/docker/dockerbuildcontext/">
    <span class="title">« 上一页</span>
    <br>
    <span>DockerbuildContext</span>
  </a>
  <a class="next" href="https://deemoprobe.github.io/posts/tech/docker/dockercli/">
    <span class="title">下一页 »</span>
    <br>
    <span>DockerCommandLineInterface</span>
  </a>
</nav>

        </footer>
    </div>
</article>
</main>

<footer class="footer">
    
        <span id="runtime_span"></span>
        <script
            type="text/javascript">function show_runtime() { window.setTimeout("show_runtime()", 1000); X = new Date("1/1/2023 1:00:00"); Y = new Date(); T = (Y.getTime() - X.getTime()); M = 24 * 60 * 60 * 1000; a = T / M; A = Math.floor(a); b = (a - A) * 24; B = Math.floor(b); c = (b - B) * 60; C = Math.floor((b - B) * 60); D = Math.floor((c - C) * 60); runtime_span.innerHTML = "网站已运行" + A + "天" + B + "小时" + C + "分" + D + "秒" } show_runtime();</script>
    
    
    <br>
    <span>
        Copyright
        &copy;
        2022-2023
        <a href="https://deemoprobe.github.io/" style="color:#939393;">William&#39;s Blog</a>
        All Rights Reserved
    </span>
    
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <span class="topInner">
        <svg class="topSvg" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
            <path d="M12 6H0l6-6z"/>
        </svg>
        <span id="read_progress"></span>
    </span>
</a>

<script>
    document.addEventListener('scroll', function (e) {
        const readProgress = document.getElementById("read_progress");
        const scrollHeight = document.documentElement.scrollHeight;
        const clientHeight = document.documentElement.clientHeight;
        const scrollTop = document.documentElement.scrollTop || document.body.scrollTop;
        readProgress.innerText = ((scrollTop / (scrollHeight - clientHeight)).toFixed(2) * 100).toFixed(0);
    })
</script>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });
</script>
<script>
    let mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 200 || document.documentElement.scrollTop > 200) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };
</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        (function() {
            document.cookie = "change-themes" + "="+ escape ("false");
        })()

        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    });
</script>

<script>
    document.body.addEventListener('copy', function (e) {
        if (window.getSelection().toString() && window.getSelection().toString().length > 50) {
            let clipboardData = e.clipboardData || window.clipboardData;
            if (clipboardData) {
                e.preventDefault();
                let htmlData = window.getSelection().toString() +
                    '\r\n\n————————————————\r\n' +
                    '版权声明：本文为「'+"William's Blog"+'」的原创文章，遵循CC 4.0 BY-SA版权协议，转载请附上原文出处链接及本声明。' +
                '\r\n原文链接：' + location.href;
                let textData = window.getSelection().toString() +
                    '\r\n\n————————————————\r\n' +
                    '版权声明：本文为「'+"William's Blog"+'」的原创文章，遵循CC 4.0 BY-SA版权协议，转载请附上原文出处链接及本声明。' +
                '\r\n原文链接：' + location.href;
                clipboardData.setData('text/html', htmlData);
                clipboardData.setData('text/plain', textData);
            }
        }
    });
</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;
        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerText = '📄复制';

        function copyingDone() {
            copybutton.innerText = '👌🏻已复制!';
            setTimeout(() => {
                copybutton.innerText = '📄复制';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                let text = codeblock.textContent +
                    '\r\n————————————————\r\n' +
                    '版权声明：本文为「'+"William's Blog"+'」的原创文章，遵循CC 4.0 BY-SA版权协议，转载请附上原文出处链接及本声明。' +
                '\r\n原文链接：' + location.href;
                navigator.clipboard.writeText(text);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) {}
            selection.removeRange(range);
        });

        let language = codeblock.className.replaceAll("language-", "")
        let macTool = document.createElement("div")
        let macTool1 = document.createElement("div")
        let macTool2 = document.createElement("div")
        let macTool3 = document.createElement("div")
        let languageType = document.createElement("div")
        languageType.innerText = language
        macTool.setAttribute('class', 'mac-tool')
        macTool1.setAttribute('class', 'mac bb1')
        macTool2.setAttribute('class', 'mac bb2')
        macTool3.setAttribute('class', 'mac bb3')
        languageType.setAttribute('class', 'language-type')
        macTool.appendChild(macTool1)
        macTool.appendChild(macTool2)
        macTool.appendChild(macTool3)
        macTool.appendChild(languageType)

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
            container.appendChild(macTool)
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
            container.appendChild(macTool)
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
            container.appendChild(macTool)
        }
    });
</script>

<script>
    $("code[class^=language] ").on("mouseover", function () {
        if (this.clientWidth < this.scrollWidth) {
            $(this).css("width", "135%")
            $(this).css("border-top-right-radius", "var(--radius)")
        }
    }).on("mouseout", function () {
        $(this).css("width", "100%")
        $(this).css("border-top-right-radius", "unset")
    })
</script>
</body>

</html>
